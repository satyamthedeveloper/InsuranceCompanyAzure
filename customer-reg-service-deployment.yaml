apiVersion: apps/v1
kind: Deployment
metadata: 
  labels: 
    app: customer-registration-service
  name: customer-reg-service-deployment
spec: 
  replicas: 1
  selector: 
    matchLabels: 
      app: customer-registration-service
  template: 
    metadata: 
      labels: 
        app: customer-registration-service
    spec: 
      containers: 
      - name: customer-registration-service
        image: insuranceprojectregistery.azurecr.io/customer-registration-service:v1
        imagePullPolicy: Always
        ports:
          - containerPort: 8764
        #restartPolicy: Always
        
        env: 
        #----------------------------
        - name: SPRING_DATASOURCE_URL
          valueFrom: 
            configMapKeyRef:
              name: customer-reg-service-configmap
              key: database_url
        #----------------------------
        - name: SPRING_DATASOURCE_USERNAME
          valueFrom:
            secretKeyRef:
              name: customer-reg-service-secrets
              key: mysql-root-username
        #----------------------------
        - name: SPRING_DATASOURCE_PASSWORD
          valueFrom:
            secretKeyRef:
              name: customer-reg-service-secrets
              key: mysql-root-password
        #----------------------------
        - name: FILE_UPLOAD_PATH
          valueFrom: 
            configMapKeyRef:
              name: customer-reg-service-configmap
              key: file_upload_path
        #----------------------------
        - name: CONTAINER_NAME
          valueFrom: 
            configMapKeyRef:
              name: customer-reg-service-configmap
              key: container_name
        #----------------------------
        - name: SPRING_REDIS_HOST
          valueFrom: 
            configMapKeyRef:
              name: customer-reg-service-configmap
              key: redis_host
        #----------------------------
        - name: SPRING_REDIS_PASSWORD
          valueFrom: 
            configMapKeyRef:
              name: customer-reg-service-configmap
              key: redis_password
--- 
apiVersion: v1
kind: Service
metadata: 
  name: customer-service
spec: 
  selector: 
    app: customer-registration-service
  type: LoadBalancer
  ports: 
    - protocol: TCP
      port: 8764
      targetPort: 8764
      nodePort: 30006